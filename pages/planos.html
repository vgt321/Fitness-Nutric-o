<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planos - Fitness NutricÃ£o</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <!-- CABEÃ‡ALHO -->
    <header>
        <div class="container">
            <h1>ğŸ“‹ Planos de Treino e NutriÃ§Ã£o</h1>
            <p>Crie e gerencie planos personalizados</p>
        </div>
    </header>

    <!-- MENU DE NAVEGAÃ‡ÃƒO -->
    <nav>
        <div class="container">
            <a href="../index.html" class="btn-nav">ğŸ  InÃ­cio</a>
            <a href="clientes.html" class="btn-nav">ğŸ‘¥ Clientes</a>
            <a href="avaliacoes.html" class="btn-nav">ğŸ“Š AvaliaÃ§Ãµes</a>
            <a href="planos.html" class="btn-nav active">ğŸ“‹ Planos</a>
            <a href="consultas.html" class="btn-nav">ğŸ“… Consultas</a>
            <a href="financeiro.html" class="btn-nav">ğŸ’° Financeiro</a>
        </div>
    </nav>

    <!-- CONTEÃšDO PRINCIPAL -->
    <main class="container">
        <!-- FORMULÃRIO DE PLANO -->
        <div class="form-box">
            <h2>ğŸ“ Criar Novo Plano</h2>
            <form id="formPlano">
                <!-- Select para escolher cliente -->
                <div class="form-group">
                    <label for="clienteId">Selecione o Cliente *</label>
                    <select id="clienteId" required>
                        <option value="">Selecione um cliente...</option>
                    </select>
                    <!-- Mostra se o cliente Ã© VIP ou Normal -->
                    <small id="clienteTipo" style="color: #666;"></small>
                </div>

                <!-- Objetivo do plano -->
                <div class="form-group">
                    <label for="objetivo">Objetivo do Plano *</label>
                    <select id="objetivo" required>
                        <option value="">Selecione o objetivo...</option>
                        <option value="Emagrecimento">ğŸ”¥ Emagrecimento</option>
                        <option value="Ganho de Massa">ğŸ’ª Ganho de Massa Muscular</option>
                        <option value="ReeducaÃ§Ã£o Alimentar">ğŸ¥— ReeducaÃ§Ã£o Alimentar</option>
                        <option value="Condicionamento">ğŸƒ Condicionamento FÃ­sico</option>
                        <option value="SaÃºde e Bem-estar">â¤ï¸ SaÃºde e Bem-estar</option>
                    </select>
                </div>

                <!-- DescriÃ§Ã£o do treino -->
                <div class="form-group">
                    <label for="descricaoTreino">DescriÃ§Ã£o do Treino *</label>
                    <textarea id="descricaoTreino" required placeholder="Descreva o plano de treino (dias, exercÃ­cios, sÃ©ries, repetiÃ§Ãµes, etc)..."></textarea>
                </div>

                <!-- DescriÃ§Ã£o da dieta -->
                <div class="form-group">
                    <label for="descricaoDieta">DescriÃ§Ã£o da Dieta/NutriÃ§Ã£o *</label>
                    <textarea id="descricaoDieta" required placeholder="Descreva o plano alimentar (refeiÃ§Ãµes, calorias, macros, restriÃ§Ãµes, etc)..."></textarea>
                </div>

                <!-- Meta semanal -->
                <div class="form-group">
                    <label for="metaSemanal">Meta Semanal</label>
                    <input type="text" id="metaSemanal" placeholder="Ex: Perder 0.5kg, Treinar 4x na semana, etc">
                </div>

                <!-- Data inÃ­cio e fim -->
                <div class="form-group">
                    <label for="dataInicio">Data de InÃ­cio *</label>
                    <input type="date" id="dataInicio" required>
                </div>

                <div class="form-group">
                    <label for="dataFim">Data de TÃ©rmino (PrevisÃ£o)</label>
                    <input type="date" id="dataFim">
                </div>

                <!-- Status do plano -->
                <div class="form-group">
                    <label for="status">Status do Plano *</label>
                    <select id="status" required>
                        <option value="Ativo">âœ… Ativo</option>
                        <option value="Pausado">â¸ï¸ Pausado</option>
                        <option value="ConcluÃ­do">âœ”ï¸ ConcluÃ­do</option>
                        <option value="Cancelado">âŒ Cancelado</option>
                    </select>
                </div>

                <!-- ObservaÃ§Ãµes extras -->
                <div class="form-group">
                    <label for="observacoes">ObservaÃ§Ãµes</label>
                    <textarea id="observacoes" placeholder="AnotaÃ§Ãµes adicionais, restriÃ§Ãµes, etc..."></textarea>
                </div>

                <!-- BotÃµes de aÃ§Ã£o -->
                <button type="submit" class="btn-primary">ğŸ’¾ Salvar Plano</button>
                <button type="button" class="btn-secondary" onclick="limparFormulario()">ğŸ”„ Limpar</button>
            </form>
        </div>

        <!-- MENSAGEM DE FEEDBACK -->
        <div id="mensagem" style="display: none;"></div>

        <!-- LISTA DE PLANOS -->
        <div class="table-box">
            <h2>ğŸ“‹ Planos Cadastrados</h2>
            
            <!-- Filtros de busca -->
            <div style="margin-bottom: 15px;">
                <!-- Filtrar por cliente -->
                <select id="filtroCliente" style="padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; margin-right: 10px;">
                    <option value="">ğŸ“Œ Todos os clientes</option>
                </select>
                
                <!-- Filtrar por status -->
                <select id="filtroStatus" style="padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; margin-right: 10px;">
                    <option value="">ğŸ“Š Todos os status</option>
                    <option value="Ativo">âœ… Ativo</option>
                    <option value="Pausado">â¸ï¸ Pausado</option>
                    <option value="ConcluÃ­do">âœ”ï¸ ConcluÃ­do</option>
                    <option value="Cancelado">âŒ Cancelado</option>
                </select>
                
                <!-- Campo de busca -->
                <input type="text" id="buscarPlano" placeholder="ğŸ” Buscar..." 
                       style="padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
            </div>
            
            <!-- Tabela de planos -->
            <table id="tabelaPlanos">
                <thead>
                    <tr>
                        <th>Cliente</th>
                        <th>Objetivo</th>
                        <th>Data InÃ­cio</th>
                        <th>Status</th>
                        <th>Tipo Cliente</th>
                        <th>AÃ§Ãµes</th>
                    </tr>
                </thead>
                <tbody id="listaPlanos">
                    <tr>
                        <td colspan="6" style="text-align: center; color: #999;">
                            Nenhum plano cadastrado ainda
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>

    <!-- RODAPÃ‰ -->
    <footer>
        <div class="container">
            <p>&copy; 2024 Vida SaudÃ¡vel - Todos os direitos reservados</p>
        </div>
    </footer>

    <script>
        // Quando a pÃ¡gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            carregarClientesSelect(); // Carrega lista de clientes
            carregarPlanos(); // Carrega planos cadastrados
            
            // Define data de hoje automaticamente
            document.getElementById('dataInicio').valueAsDate = new Date();
        });

        // Carrega clientes nos selects (formulÃ¡rio e filtro)
        function carregarClientesSelect() {
            const clientes = JSON.parse(localStorage.getItem('clientes')) || [];
            const selectCliente = document.getElementById('clienteId');
            const filtroCliente = document.getElementById('filtroCliente');
            
            // Limpa os selects
            selectCliente.innerHTML = '<option value="">Selecione um cliente...</option>';
            filtroCliente.innerHTML = '<option value="">ğŸ“Œ Todos os clientes</option>';
            
            // Adiciona cada cliente nas opÃ§Ãµes
            clientes.forEach(cliente => {
                // OpÃ§Ã£o para formulÃ¡rio
                const option1 = document.createElement('option');
                option1.value = cliente.id;
                option1.textContent = `${cliente.nome} - ${cliente.tipo}`;
                option1.dataset.tipo = cliente.tipo;
                selectCliente.appendChild(option1);
                
                // OpÃ§Ã£o para filtro
                const option2 = document.createElement('option');
                option2.value = cliente.id;
                option2.textContent = cliente.nome;
                filtroCliente.appendChild(option2);
            });
        }

        // Mostra tipo do cliente quando selecionado
        document.getElementById('clienteId').addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            const tipo = selectedOption.dataset.tipo;
            const clienteTipo = document.getElementById('clienteTipo');
            
            // Mensagem diferente para VIP
            if (tipo === 'VIP') {
                clienteTipo.innerHTML = 'â­ Cliente VIP - Tem direito a atualizaÃ§Ãµes semanais personalizadas!';
                clienteTipo.style.color = '#ffc107';
            } else if (tipo === 'Normal') {
                clienteTipo.innerHTML = 'ğŸ‘¤ Cliente Normal';
                clienteTipo.style.color = '#666';
            } else {
                clienteTipo.innerHTML = '';
            }
        });

        // Salva novo plano
        document.getElementById('formPlano').addEventListener('submit', function(e) {
            e.preventDefault(); // Evita recarregar a pÃ¡gina
            
            // Busca dados do cliente selecionado
            const clienteId = parseInt(document.getElementById('clienteId').value);
            const clientes = JSON.parse(localStorage.getItem('clientes')) || [];
            const cliente = clientes.find(c => c.id === clienteId);
            
            if (!cliente) {
                mostrarMensagem('Cliente nÃ£o encontrado!', 'danger');
                return;
            }
            
            // Cria objeto do plano com todos os dados
            const plano = {
                id: Date.now(), // ID Ãºnico baseado no timestamp
                clienteId: clienteId,
                clienteNome: cliente.nome,
                clienteTipo: cliente.tipo,
                objetivo: document.getElementById('objetivo').value,
                descricaoTreino: document.getElementById('descricaoTreino').value,
                descricaoDieta: document.getElementById('descricaoDieta').value,
                metaSemanal: document.getElementById('metaSemanal').value,
                dataInicio: document.getElementById('dataInicio').value,
                dataFim: document.getElementById('dataFim').value,
                status: document.getElementById('status').value,
                observacoes: document.getElementById('observacoes').value,
                dataCadastro: new Date().toISOString(),
                ultimaAtualizacao: new Date().toISOString()
            };
            
            // Salva no localStorage
            let planos = JSON.parse(localStorage.getItem('planos')) || [];
            planos.push(plano);
            localStorage.setItem('planos', JSON.stringify(planos));
            
            mostrarMensagem('Plano cadastrado com sucesso! âœ…', 'success');
            limparFormulario();
            carregarPlanos();
        });

        // Carrega e exibe planos na tabela
        function carregarPlanos(filtroClienteId = null, filtroStatusVal = null) {
            let planos = JSON.parse(localStorage.getItem('planos')) || [];
            const tbody = document.getElementById('listaPlanos');
            
            // Aplica filtros se existirem
            if (filtroClienteId) {
                planos = planos.filter(p => p.clienteId === parseInt(filtroClienteId));
            }
            
            if (filtroStatusVal) {
                planos = planos.filter(p => p.status === filtroStatusVal);
            }
            
            // Se nÃ£o houver planos
            if (planos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #999;">Nenhum plano encontrado</td></tr>';
                return;
            }
            
            // Ordena por data (mais recente primeiro)
            planos.sort((a, b) => new Date(b.dataInicio) - new Date(a.dataInicio));
            
            tbody.innerHTML = '';
            
            // Cria linha para cada plano
            planos.forEach(plano => {
                const tr = document.createElement('tr');
                
                // Define cor do badge de status
                let badgeStatus = 'badge-success';
                if (plano.status === 'Pausado') badgeStatus = 'badge-normal';
                if (plano.status === 'Cancelado') badgeStatus = 'badge-danger';
                
                const badgeTipo = plano.clienteTipo === 'VIP' ? 'badge-vip' : 'badge-normal';
                
                // Monta HTML da linha
                tr.innerHTML = `
                    <td>${plano.clienteNome}</td>
                    <td>${plano.objetivo}</td>
                    <td>${formatarData(plano.dataInicio)}</td>
                    <td><span class="badge ${badgeStatus}">${plano.status}</span></td>
                    <td><span class="badge ${badgeTipo}">${plano.clienteTipo}</span></td>
                    <td>
                        <button class="btn-primary" style="padding: 5px 10px; font-size: 0.9em; margin-right: 5px;" 
                                onclick="verDetalhes(${plano.id})">ğŸ‘ï¸ Ver</button>
                        ${plano.clienteTipo === 'VIP' ? 
                            `<button class="btn-primary" style="padding: 5px 10px; font-size: 0.9em; margin-right: 5px; background-color: #ffc107; color: #333;" 
                                onclick="atualizarPlano(${plano.id})">â­ Atualizar</button>` : ''}
                        <button class="btn-danger" style="padding: 5px 10px; font-size: 0.9em;" 
                                onclick="excluirPlano(${plano.id})">ğŸ—‘ï¸ Excluir</button>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        // Filtro por cliente
        document.getElementById('filtroCliente').addEventListener('change', function(e) {
            const clienteId = e.target.value;
            const status = document.getElementById('filtroStatus').value;
            carregarPlanos(clienteId || null, status || null);
        });

        // Filtro por status
        document.getElementById('filtroStatus').addEventListener('change', function(e) {
            const status = e.target.value;
            const clienteId = document.getElementById('filtroCliente').value;
            carregarPlanos(clienteId || null, status || null);
        });

        // Busca em tempo real
        document.getElementById('buscarPlano').addEventListener('input', function(e) {
            const termo = e.target.value.toLowerCase();
            const planos = JSON.parse(localStorage.getItem('planos')) || [];
            
            // Filtra planos que correspondem ao termo
            const planosFiltrados = planos.filter(p => 
                p.clienteNome.toLowerCase().includes(termo) ||
                p.objetivo.toLowerCase().includes(termo) ||
                p.status.toLowerCase().includes(termo)
            );
            
            const tbody = document.getElementById('listaPlanos');
            tbody.innerHTML = '';
            
            if (planosFiltrados.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #999;">Nenhum plano encontrado</td></tr>';
                return;
            }
            
            // Exibe resultados da busca
            planosFiltrados.forEach(plano => {
                const tr = document.createElement('tr');
                
                let badgeStatus = 'badge-success';
                if (plano.status === 'Pausado') badgeStatus = 'badge-normal';
                if (plano.status === 'Cancelado') badgeStatus = 'badge-danger';
                
                const badgeTipo = plano.clienteTipo === 'VIP' ? 'badge-vip' : 'badge-normal';
                
                tr.innerHTML = `
                    <td>${plano.clienteNome}</td>
                    <td>${plano.objetivo}</td>
                    <td>${formatarData(plano.dataInicio)}</td>
                    <td><span class="badge ${badgeStatus}">${plano.status}</span></td>
                    <td><span class="badge ${badgeTipo}">${plano.clienteTipo}</span></td>
                    <td>
                        <button class="btn-primary" style="padding: 5px 10px; font-size: 0.9em; margin-right: 5px;" 
                                onclick="verDetalhes(${plano.id})">ğŸ‘ï¸ Ver</button>
                        ${plano.clienteTipo === 'VIP' ? 
                            `<button class="btn-primary" style="padding: 5px 10px; font-size: 0.9em; margin-right: 5px; background-color: #ffc107; color: #333;" 
                                onclick="atualizarPlano(${plano.id})">â­ Atualizar</button>` : ''}
                        <button class="btn-danger" style="padding: 5px 10px; font-size: 0.9em;" 
                                onclick="excluirPlano(${plano.id})">ğŸ—‘ï¸ Excluir</button>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        });

        // Atualiza plano (funÃ§Ã£o exclusiva VIP)
        function atualizarPlano(id) {
            let planos = JSON.parse(localStorage.getItem('planos')) || [];
            const plano = planos.find(p => p.id === id);
            
            if (!plano) {
                alert('Plano nÃ£o encontrado!');
                return;
            }
            
            // Pede novos dados via prompt
            const novoTreino = prompt('ğŸ“ Atualizar DescriÃ§Ã£o do Treino:', plano.descricaoTreino);
            if (novoTreino !== null) {
                plano.descricaoTreino = novoTreino;
            }
            
            const novaDieta = prompt('ğŸ¥— Atualizar DescriÃ§Ã£o da Dieta:', plano.descricaoDieta);
            if (novaDieta !== null) {
                plano.descricaoDieta = novaDieta;
            }
            
            const novaMeta = prompt('ğŸ¯ Atualizar Meta Semanal:', plano.metaSemanal);
            if (novaMeta !== null) {
                plano.metaSemanal = novaMeta;
            }
            
            // Registra horÃ¡rio da atualizaÃ§Ã£o
            plano.ultimaAtualizacao = new Date().toISOString();
            
            // Salva alteraÃ§Ãµes
            planos = planos.map(p => p.id === id ? plano : p);
            localStorage.setItem('planos', JSON.stringify(planos));
            
            mostrarMensagem('â­ Plano VIP atualizado com sucesso!', 'success');
            carregarPlanos();
        }

        // Exclui plano
        function excluirPlano(id) {
            if (confirm('Tem certeza que deseja excluir este plano?')) {
                let planos = JSON.parse(localStorage.getItem('planos')) || [];
                planos = planos.filter(p => p.id !== id);
                localStorage.setItem('planos', JSON.stringify(planos));
                mostrarMensagem('Plano excluÃ­do com sucesso!', 'success');
                carregarPlanos();
            }
        }

        // Mostra detalhes completos do plano
        function verDetalhes(id) {
            const planos = JSON.parse(localStorage.getItem('planos')) || [];
            const plano = planos.find(p => p.id === id);
            
            if (plano) {
                alert(`
ğŸ“‹ DETALHES DO PLANO

Cliente: ${plano.clienteNome} (${plano.clienteTipo})
Objetivo: ${plano.objetivo}
Status: ${plano.status}

ğŸ‹ï¸ TREINO:
${plano.descricaoTreino}

ğŸ¥— DIETA:
${plano.descricaoDieta}

ğŸ¯ Meta Semanal: ${plano.metaSemanal || 'NÃ£o definida'}
ğŸ“… InÃ­cio: ${formatarData(plano.dataInicio)}
ğŸ“… TÃ©rmino: ${plano.dataFim ? formatarData(plano.dataFim) : 'NÃ£o definido'}
ğŸ”„ Ãšltima AtualizaÃ§Ã£o: ${new Date(plano.ultimaAtualizacao).toLocaleString('pt-BR')}

ğŸ“ ObservaÃ§Ãµes: ${plano.observacoes || 'Nenhuma'}
                `);
            }
        }

        // Limpa todos os campos do formulÃ¡rio
        function limparFormulario() {
            document.getElementById('formPlano').reset();
            document.getElementById('clienteTipo').innerHTML = '';
            document.getElementById('dataInicio').valueAsDate = new Date();
        }

        // Exibe mensagem temporÃ¡ria de sucesso/erro
        function mostrarMensagem(texto, tipo) {
            const div = document.getElementById('mensagem');
            div.className = tipo === 'success' ? 'alert alert-success' : 'alert alert-danger';
            div.textContent = texto;
            div.style.display = 'block';
            
            // Esconde apÃ³s 3 segundos
            setTimeout(() => {
                div.style.display = 'none';
            }, 3000);
        }

        // Converte data para formato brasileiro
        function formatarData(data) {
            const d = new Date(data + 'T00:00:00');
            return d.toLocaleDateString('pt-BR');
        }
    </script>
</body>
</html>