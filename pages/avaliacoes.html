<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avalia√ß√µes F√≠sicas - Fitness Nutric√£o</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <!-- CABE√áALHO -->
    <header>
        <div class="container">
            <h1>üìä Avalia√ß√µes F√≠sicas</h1>
            <p>Registre e acompanhe a evolu√ß√£o dos clientes</p>
        </div>
    </header>

    <!-- MENU DE NAVEGA√á√ÉO -->
    <nav>
        <div class="container">
            <a href="../index.html" class="btn-nav">üè† In√≠cio</a>
            <a href="clientes.html" class="btn-nav">üë• Clientes</a>
            <a href="avaliacoes.html" class="btn-nav active">üìä Avalia√ß√µes</a>
            <a href="planos.html" class="btn-nav">üìã Planos</a>
            <a href="consultas.html" class="btn-nav">üìÖ Consultas</a>
            <a href="financeiro.html" class="btn-nav">üí∞ Financeiro</a>
        </div>
    </nav>

    <!-- CONTE√öDO PRINCIPAL -->
    <main class="container">
        <!-- FORMUL√ÅRIO DE AVALIA√á√ÉO -->
        <div class="form-box">
            <h2>üìù Registrar Nova Avalia√ß√£o</h2>
            <form id="formAvaliacao">
                <div class="form-group">
                    <label for="clienteId">Selecione o Cliente *</label>
                    <select id="clienteId" required>
                        <option value="">Selecione um cliente...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="peso">Peso (kg) *</label>
                    <input type="number" id="peso" step="0.1" required placeholder="Ex: 75.5">
                </div>

                <div class="form-group">
                    <label for="altura">Altura (cm) *</label>
                    <input type="number" id="altura" step="0.1" required placeholder="Ex: 175">
                </div>

                <div class="form-group">
                    <label for="imc">IMC (Calculado Automaticamente)</label>
                    <input type="text" id="imc" readonly placeholder="Ser√° calculado automaticamente" 
                           style="background-color: #f0f0f0; cursor: not-allowed;">
                </div>

                <div class="form-group">
                    <label for="classificacaoIMC">Classifica√ß√£o do IMC</label>
                    <input type="text" id="classificacaoIMC" readonly placeholder="Ser√° calculado automaticamente" 
                           style="background-color: #f0f0f0; cursor: not-allowed;">
                </div>

                <div class="form-group">
                    <label for="dataAvaliacao">Data da Avalia√ß√£o *</label>
                    <input type="date" id="dataAvaliacao" required>
                </div>

                <div class="form-group">
                    <label for="observacoes">Observa√ß√µes</label>
                    <textarea id="observacoes" placeholder="Anota√ß√µes sobre a avalia√ß√£o, medidas, etc..."></textarea>
                </div>

                <button type="submit" class="btn-primary">üíæ Salvar Avalia√ß√£o</button>
                <button type="button" class="btn-secondary" onclick="limparFormulario()">üîÑ Limpar</button>
            </form>
        </div>

        <!-- MENSAGEM -->
        <div id="mensagem" style="display: none;"></div>

        <!-- LISTA DE AVALIA√á√ïES -->
        <div class="table-box">
            <h2>üìã Hist√≥rico de Avalia√ß√µes</h2>
            <div style="margin-bottom: 15px;">
                <select id="filtroCliente" style="padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; margin-right: 10px;">
                    <option value="">üìå Todos os clientes</option>
                </select>
                <input type="text" id="buscarAvaliacao" placeholder="üîç Buscar..." 
                       style="padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
            </div>
            <table id="tabelaAvaliacoes">
                <thead>
                    <tr>
                        <th>Cliente</th>
                        <th>Data</th>
                        <th>Peso (kg)</th>
                        <th>Altura (cm)</th>
                        <th>IMC</th>
                        <th>Classifica√ß√£o</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="listaAvaliacoes">
                    <tr>
                        <td colspan="7" style="text-align: center; color: #999;">
                            Nenhuma avalia√ß√£o cadastrada ainda
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>

    <!-- RODAP√â -->
    <footer>
        <div class="container">
            <p>&copy; 2024 Vida Saud√°vel - Todos os direitos reservados</p>
        </div>
    </footer>

    <script>
        // CARREGAR CLIENTES NO SELECT
        document.addEventListener('DOMContentLoaded', function() {
            carregarClientesSelect();
            carregarAvaliacoes();
            
            // Auto-completar data com hoje
            document.getElementById('dataAvaliacao').valueAsDate = new Date();
        });

        function carregarClientesSelect() {
            const clientes = JSON.parse(localStorage.getItem('clientes')) || [];
            const selectCliente = document.getElementById('clienteId');
            const filtroCliente = document.getElementById('filtroCliente');
            
            selectCliente.innerHTML = '<option value="">Selecione um cliente...</option>';
            filtroCliente.innerHTML = '<option value="">üìå Todos os clientes</option>';
            
            clientes.forEach(cliente => {
                const option1 = document.createElement('option');
                option1.value = cliente.id;
                option1.textContent = `${cliente.nome} - ${cliente.tipo}`;
                selectCliente.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = cliente.id;
                option2.textContent = cliente.nome;
                filtroCliente.appendChild(option2);
            });
        }

        // CALCULAR IMC AUTOMATICAMENTE
        document.getElementById('peso').addEventListener('input', calcularIMC);
        document.getElementById('altura').addEventListener('input', calcularIMC);

        function calcularIMC() {
            const peso = parseFloat(document.getElementById('peso').value);
            const alturaCm = parseFloat(document.getElementById('altura').value);
            
            if (peso && alturaCm) {
                const alturaM = alturaCm / 100;
                const imc = (peso / (alturaM * alturaM)).toFixed(2);
                
                document.getElementById('imc').value = imc;
                document.getElementById('classificacaoIMC').value = classificarIMC(imc);
            }
        }

        function classificarIMC(imc) {
            if (imc < 18.5) return '‚ö†Ô∏è Abaixo do peso';
            if (imc < 25) return '‚úÖ Peso normal';
            if (imc < 30) return '‚ö†Ô∏è Sobrepeso';
            if (imc < 35) return 'üî¥ Obesidade Grau I';
            if (imc < 40) return 'üî¥ Obesidade Grau II';
            return 'üî¥ Obesidade Grau III';
        }

        // SALVAR AVALIA√á√ÉO
        document.getElementById('formAvaliacao').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const clienteId = parseInt(document.getElementById('clienteId').value);
            const clientes = JSON.parse(localStorage.getItem('clientes')) || [];
            const cliente = clientes.find(c => c.id === clienteId);
            
            if (!cliente) {
                mostrarMensagem('Cliente n√£o encontrado!', 'danger');
                return;
            }
            
            const avaliacao = {
                id: Date.now(),
                clienteId: clienteId,
                clienteNome: cliente.nome,
                peso: parseFloat(document.getElementById('peso').value),
                altura: parseFloat(document.getElementById('altura').value),
                imc: parseFloat(document.getElementById('imc').value),
                classificacao: document.getElementById('classificacaoIMC').value,
                dataAvaliacao: document.getElementById('dataAvaliacao').value,
                observacoes: document.getElementById('observacoes').value,
                dataCadastro: new Date().toISOString()
            };
            
            let avaliacoes = JSON.parse(localStorage.getItem('avaliacoes')) || [];
            avaliacoes.push(avaliacao);
            localStorage.setItem('avaliacoes', JSON.stringify(avaliacoes));
            
            mostrarMensagem('Avalia√ß√£o registrada com sucesso! ‚úÖ', 'success');
            limparFormulario();
            carregarAvaliacoes();
        });

        // CARREGAR AVALIA√á√ïES
        function carregarAvaliacoes(filtroClienteId = null) {
            let avaliacoes = JSON.parse(localStorage.getItem('avaliacoes')) || [];
            const tbody = document.getElementById('listaAvaliacoes');
            
            if (filtroClienteId) {
                avaliacoes = avaliacoes.filter(a => a.clienteId === parseInt(filtroClienteId));
            }
            
            if (avaliacoes.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #999;">Nenhuma avalia√ß√£o encontrada</td></tr>';
                return;
            }
            
            // Ordenar por data (mais recente primeiro)
            avaliacoes.sort((a, b) => new Date(b.dataAvaliacao) - new Date(a.dataAvaliacao));
            
            tbody.innerHTML = '';
            
            avaliacoes.forEach(avaliacao => {
                const tr = document.createElement('tr');
                
                let badgeIMC = 'badge-success';
                if (avaliacao.imc < 18.5 || avaliacao.imc >= 25) badgeIMC = 'badge-danger';
                
                tr.innerHTML = `
                    <td>${avaliacao.clienteNome}</td>
                    <td>${formatarData(avaliacao.dataAvaliacao)}</td>
                    <td>${avaliacao.peso.toFixed(1)}</td>
                    <td>${avaliacao.altura.toFixed(0)}</td>
                    <td><strong>${avaliacao.imc.toFixed(2)}</strong></td>
                    <td><span class="badge ${badgeIMC}">${avaliacao.classificacao}</span></td>
                    <td>
                        <button class="btn-primary" style="padding: 5px 10px; font-size: 0.9em; margin-right: 5px;" 
                                onclick="verDetalhes(${avaliacao.id})">üëÅÔ∏è Ver</button>
                        <button class="btn-danger" style="padding: 5px 10px; font-size: 0.9em;" 
                                onclick="excluirAvaliacao(${avaliacao.id})">üóëÔ∏è Excluir</button>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        // FILTRAR POR CLIENTE
        document.getElementById('filtroCliente').addEventListener('change', function(e) {
            const clienteId = e.target.value;
            carregarAvaliacoes(clienteId || null);
        });

        // BUSCAR AVALIA√á√ÉO
        document.getElementById('buscarAvaliacao').addEventListener('input', function(e) {
            const termo = e.target.value.toLowerCase();
            const avaliacoes = JSON.parse(localStorage.getItem('avaliacoes')) || [];
            const avaliacoesFiltradas = avaliacoes.filter(a => 
                a.clienteNome.toLowerCase().includes(termo) ||
                a.classificacao.toLowerCase().includes(termo)
            );
            
            const tbody = document.getElementById('listaAvaliacoes');
            tbody.innerHTML = '';
            
            if (avaliacoesFiltradas.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #999;">Nenhuma avalia√ß√£o encontrada</td></tr>';
                return;
            }
            
            avaliacoesFiltradas.forEach(avaliacao => {
                const tr = document.createElement('tr');
                let badgeIMC = 'badge-success';
                if (avaliacao.imc < 18.5 || avaliacao.imc >= 25) badgeIMC = 'badge-danger';
                
                tr.innerHTML = `
                    <td>${avaliacao.clienteNome}</td>
                    <td>${formatarData(avaliacao.dataAvaliacao)}</td>
                    <td>${avaliacao.peso.toFixed(1)}</td>
                    <td>${avaliacao.altura.toFixed(0)}</td>
                    <td><strong>${avaliacao.imc.toFixed(2)}</strong></td>
                    <td><span class="badge ${badgeIMC}">${avaliacao.classificacao}</span></td>
                    <td>
                        <button class="btn-primary" style="padding: 5px 10px; font-size: 0.9em; margin-right: 5px;" 
                                onclick="verDetalhes(${avaliacao.id})">üëÅÔ∏è Ver</button>
                        <button class="btn-danger" style="padding: 5px 10px; font-size: 0.9em;" 
                                onclick="excluirAvaliacao(${avaliacao.id})">üóëÔ∏è Excluir</button>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        });

        // EXCLUIR AVALIA√á√ÉO
        function excluirAvaliacao(id) {
            if (confirm('Tem certeza que deseja excluir esta avalia√ß√£o?')) {
                let avaliacoes = JSON.parse(localStorage.getItem('avaliacoes')) || [];
                avaliacoes = avaliacoes.filter(a => a.id !== id);
                localStorage.setItem('avaliacoes', JSON.stringify(avaliacoes));
                mostrarMensagem('Avalia√ß√£o exclu√≠da com sucesso!', 'success');
                carregarAvaliacoes();
            }
        }

        // VER DETALHES
        function verDetalhes(id) {
            const avaliacoes = JSON.parse(localStorage.getItem('avaliacoes')) || [];
            const avaliacao = avaliacoes.find(a => a.id === id);
            
            if (avaliacao) {
                alert(`
üìä DETALHES DA AVALIA√á√ÉO

Cliente: ${avaliacao.clienteNome}
Data: ${formatarData(avaliacao.dataAvaliacao)}
Peso: ${avaliacao.peso.toFixed(1)} kg
Altura: ${avaliacao.altura.toFixed(0)} cm
IMC: ${avaliacao.imc.toFixed(2)}
Classifica√ß√£o: ${avaliacao.classificacao}
Observa√ß√µes: ${avaliacao.observacoes || 'Nenhuma'}
                `);
            }
        }

        // LIMPAR FORMUL√ÅRIO
        function limparFormulario() {
            document.getElementById('formAvaliacao').reset();
            document.getElementById('imc').value = '';
            document.getElementById('classificacaoIMC').value = '';
            document.getElementById('dataAvaliacao').valueAsDate = new Date();
        }

        // MOSTRAR MENSAGEM
        function mostrarMensagem(texto, tipo) {
            const div = document.getElementById('mensagem');
            div.className = tipo === 'success' ? 'alert alert-success' : 'alert alert-danger';
            div.textContent = texto;
            div.style.display = 'block';
            
            setTimeout(() => {
                div.style.display = 'none';
            }, 3000);
        }

        // FORMATAR DATA
        function formatarData(data) {
            const d = new Date(data + 'T00:00:00');
            return d.toLocaleDateString('pt-BR');
        }
    </script>
</body>
</html>