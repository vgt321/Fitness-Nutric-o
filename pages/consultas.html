<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consultas - Fitness NutricÃ£o</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <!-- CABEÃ‡ALHO -->
    <header>
        <div class="container">
            <h1>ğŸ“… Agendamento de Consultas</h1>
            <p>Gerencie consultas com profissionais de saÃºde</p>
        </div>
    </header>

    <!-- MENU DE NAVEGAÃ‡ÃƒO -->
    <nav>
        <div class="container">
            <a href="../index.html" class="btn-nav">ğŸ  InÃ­cio</a>
            <a href="clientes.html" class="btn-nav">ğŸ‘¥ Clientes</a>
            <a href="avaliacoes.html" class="btn-nav">ğŸ“Š AvaliaÃ§Ãµes</a>
            <a href="planos.html" class="btn-nav">ğŸ“‹ Planos</a>
            <a href="consultas.html" class="btn-nav active">ğŸ“… Consultas</a>
            <a href="financeiro.html" class="btn-nav">ğŸ’° Financeiro</a>
        </div>
    </nav>

    <!-- CONTEÃšDO PRINCIPAL -->
    <main class="container">
        <!-- FORMULÃRIO DE AGENDAMENTO -->
        <div class="form-box">
            <h2>ğŸ“ Agendar Nova Consulta</h2>
            <form id="formConsulta">
                <!-- Selecionar cliente -->
                <div class="form-group">
                    <label for="clienteId">Selecione o Cliente *</label>
                    <select id="clienteId" required>
                        <option value="">Selecione um cliente...</option>
                    </select>
                    <!-- Mostra se cliente Ã© VIP -->
                    <small id="clienteTipo" style="color: #666;"></small>
                </div>

                <!-- Tipo de profissional -->
                <div class="form-group">
                    <label for="tipoProfissional">Tipo de Profissional *</label>
                    <select id="tipoProfissional" required>
                        <option value="">Selecione...</option>
                        <option value="Personal Trainer">ğŸ‹ï¸ Personal Trainer</option>
                        <option value="Nutricionista">ğŸ¥— Nutricionista</option>
                        <option value="Ambos">ğŸ‘¥ Personal Trainer + Nutricionista</option>
                    </select>
                </div>

                <!-- Data e hora da consulta -->
                <div class="form-group">
                    <label for="dataConsulta">Data da Consulta *</label>
                    <input type="date" id="dataConsulta" required>
                </div>

                <div class="form-group">
                    <label for="horaConsulta">HorÃ¡rio *</label>
                    <input type="time" id="horaConsulta" required>
                </div>

                <!-- Status da consulta -->
                <div class="form-group">
                    <label for="status">Status *</label>
                    <select id="status" required>
                        <option value="Agendada">ğŸ“… Agendada</option>
                        <option value="Confirmada">âœ… Confirmada</option>
                        <option value="Realizada">âœ”ï¸ Realizada</option>
                        <option value="Cancelada">âŒ Cancelada</option>
                        <option value="Faltou">âš ï¸ Cliente Faltou</option>
                    </select>
                </div>

                <!-- Campos de texto -->
                <div class="form-group">
                    <label for="observacoes">ObservaÃ§Ãµes</label>
                    <textarea id="observacoes" placeholder="Motivo da consulta, preparaÃ§Ãµes necessÃ¡rias, etc..."></textarea>
                </div>

                <div class="form-group">
                    <label for="relatorioProgresso">RelatÃ³rio de Progresso (Preencher apÃ³s consulta)</label>
                    <textarea id="relatorioProgresso" placeholder="Feedback da consulta, resultados observados, recomendaÃ§Ãµes..."></textarea>
                </div>

                <!-- BotÃµes de aÃ§Ã£o -->
                <button type="submit" class="btn-primary">ğŸ’¾ Salvar Consulta</button>
                <button type="button" class="btn-secondary" onclick="limparFormulario()">ğŸ”„ Limpar</button>
            </form>
        </div>

        <!-- MENSAGEM DE FEEDBACK -->
        <div id="mensagem" style="display: none;"></div>

        <!-- ALERTA VIP -->
        <div class="alert alert-info" style="margin-bottom: 20px;">
            <strong>â­ AtenÃ§Ã£o:</strong> Clientes VIP tÃªm atendimento prioritÃ¡rio e direito a consultas extras semanais!
        </div>

        <!-- LISTA DE CONSULTAS -->
        <div class="table-box">
            <h2>ğŸ“‹ Consultas Agendadas</h2>
            
            <!-- Filtros -->
            <div style="margin-bottom: 15px;">
                <!-- Filtrar por cliente -->
                <select id="filtroCliente" style="padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; margin-right: 10px;">
                    <option value="">ğŸ“Œ Todos os clientes</option>
                </select>
                
                <!-- Filtrar por status -->
                <select id="filtroStatus" style="padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; margin-right: 10px;">
                    <option value="">ğŸ“Š Todos os status</option>
                    <option value="Agendada">ğŸ“… Agendada</option>
                    <option value="Confirmada">âœ… Confirmada</option>
                    <option value="Realizada">âœ”ï¸ Realizada</option>
                    <option value="Cancelada">âŒ Cancelada</option>
                    <option value="Faltou">âš ï¸ Faltou</option>
                </select>
                
                <!-- Filtrar por profissional -->
                <select id="filtroProfissional" style="padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; margin-right: 10px;">
                    <option value="">ğŸ‘¨â€âš•ï¸ Todos os profissionais</option>
                    <option value="Personal Trainer">ğŸ‹ï¸ Personal Trainer</option>
                    <option value="Nutricionista">ğŸ¥— Nutricionista</option>
                    <option value="Ambos">ğŸ‘¥ Ambos</option>
                </select>
            </div>

            <!-- TABELA: CONSULTAS VIP (PRIORITÃRIAS) -->
            <div id="consultasVIP" style="margin-bottom: 30px;">
                <h3 style="color: #ffc107; border-bottom: 2px solid #ffc107; padding-bottom: 10px;">
                    â­ Consultas VIP (Atendimento PrioritÃ¡rio)
                </h3>
                <table>
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Profissional</th>
                            <th>Data</th>
                            <th>HorÃ¡rio</th>
                            <th>Status</th>
                            <th>AÃ§Ãµes</th>
                        </tr>
                    </thead>
                    <tbody id="listaConsultasVIP">
                        <tr>
                            <td colspan="6" style="text-align: center; color: #999;">
                                Nenhuma consulta VIP agendada
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- TABELA: CONSULTAS REGULARES -->
            <div id="consultasNormais">
                <h3 style="color: #6c757d; border-bottom: 2px solid #6c757d; padding-bottom: 10px;">
                    ğŸ‘¤ Consultas Regulares
                </h3>
                <table>
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Profissional</th>
                            <th>Data</th>
                            <th>HorÃ¡rio</th>
                            <th>Status</th>
                            <th>AÃ§Ãµes</th>
                        </tr>
                    </thead>
                    <tbody id="listaConsultasNormais">
                        <tr>
                            <td colspan="6" style="text-align: center; color: #999;">
                                Nenhuma consulta regular agendada
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- RODAPÃ‰ -->
    <footer>
        <div class="container">
            <p>&copy; 2024 Vida SaudÃ¡vel - Todos os direitos reservados</p>
        </div>
    </footer>

    <script>
        // Quando a pÃ¡gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            carregarClientesSelect(); // Carrega lista de clientes
            carregarConsultas(); // Carrega consultas agendadas
            
            // Define data de hoje automaticamente
            const hoje = new Date();
            document.getElementById('dataConsulta').valueAsDate = hoje;
        });

        // Carrega clientes nos selects (VIPs aparecem primeiro)
        function carregarClientesSelect() {
            const clientes = JSON.parse(localStorage.getItem('clientes')) || [];
            const selectCliente = document.getElementById('clienteId');
            const filtroCliente = document.getElementById('filtroCliente');
            
            // Limpa os selects
            selectCliente.innerHTML = '<option value="">Selecione um cliente...</option>';
            filtroCliente.innerHTML = '<option value="">ğŸ“Œ Todos os clientes</option>';
            
            // Ordena: VIPs aparecem primeiro
            clientes.sort((a, b) => {
                if (a.tipo === 'VIP' && b.tipo !== 'VIP') return -1;
                if (a.tipo !== 'VIP' && b.tipo === 'VIP') return 1;
                return 0;
            });
            
            // Adiciona cada cliente
            clientes.forEach(cliente => {
                const prefixo = cliente.tipo === 'VIP' ? 'â­ ' : '';
                
                // OpÃ§Ã£o para formulÃ¡rio
                const option1 = document.createElement('option');
                option1.value = cliente.id;
                option1.textContent = `${prefixo}${cliente.nome} - ${cliente.tipo}`;
                option1.dataset.tipo = cliente.tipo;
                selectCliente.appendChild(option1);
                
                // OpÃ§Ã£o para filtro
                const option2 = document.createElement('option');
                option2.value = cliente.id;
                option2.textContent = `${prefixo}${cliente.nome}`;
                filtroCliente.appendChild(option2);
            });
        }

        // Mostra mensagem especial para clientes VIP
        document.getElementById('clienteId').addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            const tipo = selectedOption.dataset.tipo;
            const clienteTipo = document.getElementById('clienteTipo');
            
            if (tipo === 'VIP') {
                clienteTipo.innerHTML = 'â­ Cliente VIP - Atendimento prioritÃ¡rio e consultas extras!';
                clienteTipo.style.color = '#ffc107';
                clienteTipo.style.fontWeight = 'bold';
            } else if (tipo === 'Normal') {
                clienteTipo.innerHTML = 'ğŸ‘¤ Cliente Normal';
                clienteTipo.style.color = '#666';
            } else {
                clienteTipo.innerHTML = '';
            }
        });

        // Salva nova consulta
        document.getElementById('formConsulta').addEventListener('submit', function(e) {
            e.preventDefault(); // Evita recarregar pÃ¡gina
            
            // Busca dados do cliente
            const clienteId = parseInt(document.getElementById('clienteId').value);
            const clientes = JSON.parse(localStorage.getItem('clientes')) || [];
            const cliente = clientes.find(c => c.id === clienteId);
            
            if (!cliente) {
                mostrarMensagem('Cliente nÃ£o encontrado!', 'danger');
                return;
            }
            
            // Cria objeto da consulta
            const consulta = {
                id: Date.now(),
                clienteId: clienteId,
                clienteNome: cliente.nome,
                clienteTipo: cliente.tipo,
                tipoProfissional: document.getElementById('tipoProfissional').value,
                dataConsulta: document.getElementById('dataConsulta').value,
                horaConsulta: document.getElementById('horaConsulta').value,
                status: document.getElementById('status').value,
                observacoes: document.getElementById('observacoes').value,
                relatorioProgresso: document.getElementById('relatorioProgresso').value,
                dataCadastro: new Date().toISOString()
            };
            
            // Salva no localStorage
            let consultas = JSON.parse(localStorage.getItem('consultas')) || [];
            consultas.push(consulta);
            localStorage.setItem('consultas', JSON.stringify(consultas));
            
            // Mensagem especial para VIP
            const msgTipo = cliente.tipo === 'VIP' ? 'â­ Consulta VIP agendada com prioridade!' : 'Consulta agendada com sucesso!';
            mostrarMensagem(msgTipo + ' âœ…', 'success');
            limparFormulario();
            carregarConsultas();
        });

        // Carrega e exibe consultas (separadas: VIP e Normais)
        function carregarConsultas(filtroClienteId = null, filtroStatusVal = null, filtroProfissionalVal = null) {
            let consultas = JSON.parse(localStorage.getItem('consultas')) || [];
            
            // Aplica filtros se existirem
            if (filtroClienteId) {
                consultas = consultas.filter(c => c.clienteId === parseInt(filtroClienteId));
            }
            if (filtroStatusVal) {
                consultas = consultas.filter(c => c.status === filtroStatusVal);
            }
            if (filtroProfissionalVal) {
                consultas = consultas.filter(c => c.tipoProfissional === filtroProfissionalVal);
            }
            
            // Separa consultas VIP das normais
            const consultasVIP = consultas.filter(c => c.clienteTipo === 'VIP');
            const consultasNormais = consultas.filter(c => c.clienteTipo !== 'VIP');
            
            // Ordena por data e hora
            const ordenar = (a, b) => {
                const dataHoraA = new Date(a.dataConsulta + 'T' + a.horaConsulta);
                const dataHoraB = new Date(b.dataConsulta + 'T' + b.horaConsulta);
                return dataHoraA - dataHoraB;
            };
            
            consultasVIP.sort(ordenar);
            consultasNormais.sort(ordenar);
            
            // Renderiza tabelas separadas
            renderizarConsultas(consultasVIP, 'listaConsultasVIP', true);
            renderizarConsultas(consultasNormais, 'listaConsultasNormais', false);
        }

        // Renderiza linhas da tabela de consultas
        function renderizarConsultas(consultas, tbodyId, isVIP) {
            const tbody = document.getElementById(tbodyId);
            
            // Se nÃ£o houver consultas
            if (consultas.length === 0) {
                const mensagem = isVIP ? 'Nenhuma consulta VIP agendada' : 'Nenhuma consulta regular agendada';
                tbody.innerHTML = `<tr><td colspan="6" style="text-align: center; color: #999;">${mensagem}</td></tr>`;
                return;
            }
            
            tbody.innerHTML = '';
            
            // Cria linha para cada consulta
            consultas.forEach(consulta => {
                const tr = document.createElement('tr');
                
                // Define cor do badge de status
                let badgeStatus = 'badge-success';
                if (consulta.status === 'Agendada') badgeStatus = 'badge-normal';
                if (consulta.status === 'Cancelada' || consulta.status === 'Faltou') badgeStatus = 'badge-danger';
                
                // Destaca linha se for VIP (fundo amarelo claro)
                const rowStyle = isVIP ? 'background-color: #fff9e6;' : '';
                
                tr.style = rowStyle;
                tr.innerHTML = `
                    <td>${isVIP ? 'â­ ' : ''}${consulta.clienteNome}</td>
                    <td>${consulta.tipoProfissional}</td>
                    <td>${formatarData(consulta.dataConsulta)}</td>
                    <td><strong>${consulta.horaConsulta}</strong></td>
                    <td><span class="badge ${badgeStatus}">${consulta.status}</span></td>
                    <td>
                        <button class="btn-primary" style="padding: 5px 10px; font-size: 0.9em; margin-right: 5px;" 
                                onclick="verDetalhes(${consulta.id})">ğŸ‘ï¸ Ver</button>
                        <button class="btn-secondary" style="padding: 5px 10px; font-size: 0.9em; margin-right: 5px;" 
                                onclick="adicionarRelatorio(${consulta.id})">ğŸ“ RelatÃ³rio</button>
                        <button class="btn-danger" style="padding: 5px 10px; font-size: 0.9em;" 
                                onclick="excluirConsulta(${consulta.id})">ğŸ—‘ï¸ Excluir</button>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        // Adiciona eventos aos filtros
        document.getElementById('filtroCliente').addEventListener('change', aplicarFiltros);
        document.getElementById('filtroStatus').addEventListener('change', aplicarFiltros);
        document.getElementById('filtroProfissional').addEventListener('change', aplicarFiltros);

        // Aplica todos os filtros selecionados
        function aplicarFiltros() {
            const clienteId = document.getElementById('filtroCliente').value;
            const status = document.getElementById('filtroStatus').value;
            const profissional = document.getElementById('filtroProfissional').value;
            carregarConsultas(clienteId || null, status || null, profissional || null);
        }

        // Adiciona ou edita relatÃ³rio de progresso
        function adicionarRelatorio(id) {
            let consultas = JSON.parse(localStorage.getItem('consultas')) || [];
            const consulta = consultas.find(c => c.id === id);
            
            if (!consulta) {
                alert('Consulta nÃ£o encontrada!');
                return;
            }
            
            // Pede novo relatÃ³rio via prompt
            const relatorio = prompt('ğŸ“ Digite o relatÃ³rio de progresso da consulta:', consulta.relatorioProgresso || '');
            
            if (relatorio !== null) {
                consulta.relatorioProgresso = relatorio;
                consulta.status = 'Realizada'; // Marca como realizada
                
                // Salva alteraÃ§Ãµes
                consultas = consultas.map(c => c.id === id ? consulta : c);
                localStorage.setItem('consultas', JSON.stringify(consultas));
                
                mostrarMensagem('RelatÃ³rio adicionado com sucesso!', 'success');
                carregarConsultas();
            }
        }

        // Exclui consulta
        function excluirConsulta(id) {
            if (confirm('Tem certeza que deseja excluir esta consulta?')) {
                let consultas = JSON.parse(localStorage.getItem('consultas')) || [];
                consultas = consultas.filter(c => c.id !== id);
                localStorage.setItem('consultas', JSON.stringify(consultas));
                mostrarMensagem('Consulta excluÃ­da com sucesso!', 'success');
                carregarConsultas();
            }
        }

        // Mostra detalhes completos da consulta
        function verDetalhes(id) {
            const consultas = JSON.parse(localStorage.getItem('consultas')) || [];
            const consulta = consultas.find(c => c.id === id);
            
            if (consulta) {
                const tipoCliente = consulta.clienteTipo === 'VIP' ? 'â­ VIP (PrioritÃ¡rio)' : 'ğŸ‘¤ Normal';
                alert(`
ğŸ“… DETALHES DA CONSULTA

Cliente: ${consulta.clienteNome} (${tipoCliente})
Profissional: ${consulta.tipoProfissional}
Data: ${formatarData(consulta.dataConsulta)}
HorÃ¡rio: ${consulta.horaConsulta}
Status: ${consulta.status}

ğŸ“ ObservaÃ§Ãµes: ${consulta.observacoes || 'Nenhuma'}

ğŸ“Š RelatÃ³rio de Progresso:
${consulta.relatorioProgresso || 'RelatÃ³rio ainda nÃ£o preenchido'}
                `);
            }
        }

        // Limpa todos os campos do formulÃ¡rio
        function limparFormulario() {
            document.getElementById('formConsulta').reset();
            document.getElementById('clienteTipo').innerHTML = '';
            document.getElementById('dataConsulta').valueAsDate = new Date();
        }

        // Exibe mensagem temporÃ¡ria de sucesso/erro
        function mostrarMensagem(texto, tipo) {
            const div = document.getElementById('mensagem');
            div.className = tipo === 'success' ? 'alert alert-success' : 'alert alert-danger';
            div.textContent = texto;
            div.style.display = 'block';
            
            // Esconde apÃ³s 3 segundos
            setTimeout(() => {
                div.style.display = 'none';
            }, 3000);
        }

        // Converte data para formato brasileiro
        function formatarData(data) {
            const d = new Date(data + 'T00:00:00');
            return d.toLocaleDateString('pt-BR');
        }
    </script>
</body>
</html>